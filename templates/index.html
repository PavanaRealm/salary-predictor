<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Salary Predictor</title>
    <link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>
    <style>
        :root {
            --bg: #0a0a0f;
            --surface: rgba(255,255,255,0.04);
            --border: rgba(255,255,255,0.08);
            --accent: #7c6aff;
            --accent2: #ff6a9e;
            --accent3: #6affda;
            --text: #f0f0f8;
            --muted: rgba(240,240,248,0.45);
            --glass: rgba(255,255,255,0.06);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: "DM Sans", sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
        }
        body::before {
            content: "";
            position: fixed;
            inset: 0;
            background:
                radial-gradient(ellipse 80% 60% at 20% 20%, rgba(124,106,255,0.12) 0%, transparent 60%),
                radial-gradient(ellipse 60% 40% at 80% 80%, rgba(255,106,158,0.08) 0%, transparent 60%);
            pointer-events: none;
            z-index: 0;
        }
        .container { max-width: 1100px; margin: 0 auto; padding: 40px 24px; position: relative; z-index: 1; }
        header { text-align: center; margin-bottom: 48px; animation: fadeDown 0.8s ease; }
        .badge {
            display: inline-flex; align-items: center; gap: 6px;
            background: rgba(124,106,255,0.15); border: 1px solid rgba(124,106,255,0.3);
            color: #a89fff; padding: 6px 14px; border-radius: 100px;
            font-size: 12px; font-weight: 500; letter-spacing: 0.05em;
            text-transform: uppercase; margin-bottom: 20px;
        }
        h1 {
            font-family: "Syne", sans-serif; font-size: clamp(36px, 6vw, 64px);
            font-weight: 800; line-height: 1.1; margin-bottom: 16px;
            background: linear-gradient(135deg, #fff 0%, #a89fff 50%, #ff6a9e 100%);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
        }
        .subtitle { color: var(--muted); font-size: 16px; font-weight: 300; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }
        .card {
            background: rgba(255,255,255,0.06); border: 1px solid var(--border);
            border-radius: 20px; padding: 28px; backdrop-filter: blur(20px);
            animation: fadeUp 0.6s ease forwards; opacity: 0;
        }
        .card:nth-child(1) { animation-delay: 0.1s; }
        .card:nth-child(2) { animation-delay: 0.2s; }
        .card-title {
            font-family: "Syne", sans-serif; font-size: 13px; font-weight: 700;
            text-transform: uppercase; letter-spacing: 0.1em; color: var(--muted);
            margin-bottom: 20px; display: flex; align-items: center; gap: 8px;
        }
        .card-title::before { content: ""; display: block; width: 6px; height: 6px; border-radius: 50%; background: var(--accent); }
        .tabs { display: flex; gap: 4px; background: rgba(255,255,255,0.04); border-radius: 12px; padding: 4px; margin-bottom: 24px; }
        .tab { flex: 1; padding: 10px; border: none; background: transparent; color: var(--muted); border-radius: 8px; cursor: pointer; font-size: 13px; font-weight: 500; font-family: "DM Sans", sans-serif; transition: all 0.2s; }
        .tab.active { background: var(--accent); color: white; }
        .panel { display: none; }
        .panel.active { display: block; }
        label { display: block; font-size: 12px; font-weight: 500; color: var(--muted); margin-bottom: 6px; margin-top: 14px; text-transform: uppercase; letter-spacing: 0.05em; }
        select {
            width: 100%; padding: 11px 14px; background: rgba(255,255,255,0.06);
            border: 1px solid var(--border); border-radius: 10px; color: var(--text);
            font-size: 14px; font-family: "DM Sans", sans-serif; cursor: pointer; transition: border 0.2s; appearance: none;
        }
        select:focus { outline: none; border-color: var(--accent); }
        select option { background: #1a1a2e; }
        .predict-btn {
            width: 100%; padding: 14px;
            background: linear-gradient(135deg, var(--accent), var(--accent2));
            color: white; border: none; border-radius: 12px; font-size: 15px;
            font-weight: 600; font-family: "Syne", sans-serif; cursor: pointer;
            margin-top: 20px; transition: opacity 0.2s, transform 0.2s; letter-spacing: 0.02em;
        }
        .predict-btn:hover { opacity: 0.9; transform: translateY(-1px); }
        .result {
            margin-top: 20px; padding: 24px;
            background: linear-gradient(135deg, rgba(124,106,255,0.15), rgba(255,106,158,0.1));
            border: 1px solid rgba(124,106,255,0.3); border-radius: 16px; animation: fadeUp 0.4s ease;
        }
        .result-label { font-size: 11px; text-transform: uppercase; letter-spacing: 0.1em; color: var(--muted); margin-bottom: 8px; }
        .result-salary {
            font-family: "Syne", sans-serif; font-size: 48px; font-weight: 800;
            background: linear-gradient(135deg, #fff, var(--accent));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
            line-height: 1; margin-bottom: 8px;
        }
        .result-range { display: flex; gap: 12px; margin-top: 12px; }
        .range-item { flex: 1; padding: 10px; background: rgba(255,255,255,0.05); border-radius: 10px; text-align: center; }
        .range-item .range-label { font-size: 10px; color: var(--muted); text-transform: uppercase; letter-spacing: 0.05em; }
        .range-item .range-val { font-size: 16px; font-weight: 600; font-family: "Syne", sans-serif; margin-top: 4px; }
        .range-item.min .range-val { color: var(--accent3); }
        .range-item.mid .range-val { color: var(--accent); }
        .range-item.max .range-val { color: var(--accent2); }
        .result-meta { font-size: 12px; color: var(--muted); margin-top: 12px; }
        .empty-state { display: flex; align-items: center; justify-content: center; height: 200px; color: var(--muted); text-align: center; flex-direction: column; gap: 12px; }
        .empty-state .icon { font-size: 48px; }
        .empty-state p { font-size: 14px; }
        .chat-box { height: 280px; overflow-y: auto; margin-bottom: 14px; display: flex; flex-direction: column; gap: 10px; scrollbar-width: thin; scrollbar-color: var(--accent) transparent; }
        .message { display: flex; flex-direction: column; }
        .message.user { align-items: flex-end; }
        .message.bot { align-items: flex-start; }
        .bubble { padding: 10px 14px; border-radius: 14px; max-width: 85%; font-size: 13.5px; line-height: 1.5; }
        .user .bubble { background: linear-gradient(135deg, var(--accent), var(--accent2)); color: white; border-bottom-right-radius: 4px; }
        .bot .bubble { background: rgba(255,255,255,0.07); border: 1px solid var(--border); color: var(--text); border-bottom-left-radius: 4px; }
        .chat-input { display: flex; gap: 8px; }
        .chat-input input { flex: 1; padding: 11px 14px; background: rgba(255,255,255,0.06); border: 1px solid var(--border); border-radius: 10px; color: var(--text); font-size: 13px; font-family: "DM Sans", sans-serif; }
        .chat-input input:focus { outline: none; border-color: var(--accent); }
        .chat-input input::placeholder { color: var(--muted); }
        .chat-input button { padding: 11px 16px; background: var(--accent); color: white; border: none; border-radius: 10px; cursor: pointer; font-size: 16px; }
        .hint { font-size: 11px; color: var(--muted); text-align: center; margin-bottom: 12px; padding: 8px; background: rgba(124,106,255,0.08); border-radius: 8px; }
        .charts-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }
        .chart-card { background: rgba(255,255,255,0.06); border: 1px solid var(--border); border-radius: 20px; padding: 24px; backdrop-filter: blur(20px); animation: fadeUp 0.6s ease 0.3s forwards; opacity: 0; }
        .stats-row { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; margin-bottom: 20px; }
        .stat-card { background: rgba(255,255,255,0.06); border: 1px solid var(--border); border-radius: 16px; padding: 20px; backdrop-filter: blur(20px); animation: fadeUp 0.6s ease 0.4s forwards; opacity: 0; }
        .stat-icon { font-size: 24px; margin-bottom: 8px; }
        .stat-val { font-family: "Syne", sans-serif; font-size: 28px; font-weight: 800; color: var(--accent); }
        .stat-label { font-size: 12px; color: var(--muted); margin-top: 4px; }
        @keyframes fadeDown { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-thumb { background: var(--accent); border-radius: 4px; }
        @media (max-width: 768px) { .grid, .charts-grid { grid-template-columns: 1fr; } .stats-row { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
<div class="container">
    <header>
        <div class="badge">‚ú¶ ML-Backed ¬∑ Real Data</div>
        <h1>Salary Predictor</h1>
        <p class="subtitle">Gradient Boosting ML ¬∑ 9,355 Real Salary Records ¬∑ LLaMA Chat Interface</p>
    </header>
    <div class="stats-row">
        <div class="stat-card"><div class="stat-icon">üìä</div><div class="stat-val">9,355</div><div class="stat-label">Real salary records</div></div>
        <div class="stat-card"><div class="stat-icon">üåç</div><div class="stat-val">11</div><div class="stat-label">Countries covered</div></div>
        <div class="stat-card"><div class="stat-icon">ü§ñ</div><div class="stat-val">8</div><div class="stat-label">Job categories</div></div>
    </div>
    <div class="grid">
        <div class="card">
            <div class="tabs">
                <button class="tab active" onclick="showTab('form', this)">üìã Form</button>
                <button class="tab" onclick="showTab('chat', this)">üí¨ Chat</button>
            </div>
            <div id="form-panel" class="panel active">
                <form action="/predict" method="post">
                    <label>Job Title</label>
                    <select name="job_title" required>
                        <option value="">Select Job Title</option>
                        {% for job in job_titles %}<option value="{{ job }}" {% if job == job_title %}selected{% endif %}>{{ job }}</option>{% endfor %}
                    </select>
                    <label>Location</label>
                    <select name="location" required>
                        <option value="">Select Location</option>
                        {% for loc in locations %}<option value="{{ loc }}" {% if loc == location %}selected{% endif %}>{{ loc }}</option>{% endfor %}
                    </select>
                    <label>Experience Level</label>
                    <select name="experience" required>
                        <option value="">Select Experience</option>
                        {% for exp in experiences %}<option value="{{ exp }}" {% if exp == experience %}selected{% endif %}>{{ exp }}</option>{% endfor %}
                    </select>
                    <label>Employment Type</label>
                    <select name="employment" required>
                        <option value="">Select Employment Type</option>
                        {% for emp in employments %}<option value="{{ emp }}" {% if emp == employment %}selected{% endif %}>{{ emp }}</option>{% endfor %}
                    </select>
                    <label>Company Size</label>
                    <select name="size" required>
                        <option value="">Select Company Size</option>
                        <option value="S" {% if size == "S" %}selected{% endif %}>Small</option>
                        <option value="M" {% if size == "M" %}selected{% endif %}>Medium</option>
                        <option value="L" {% if size == "L" %}selected{% endif %}>Large</option>
                    </select>
                    <button type="submit" class="predict-btn">Predict Salary ‚Üí</button>
                </form>
            </div>
            <div id="chat-panel" class="panel">
                <p class="hint">üí° "What is the salary for a Senior Data Scientist in Germany at a large company?"</p>
                <div class="chat-box" id="chat-box">
                    <div class="message bot"><div class="bubble">üëã Hi! Ask me about salaries for any role, location and experience level!</div></div>
                </div>
                <div class="chat-input">
                    <input type="text" id="chat-input" placeholder="Ask about salaries..." />
                    <button onclick="sendMessage()">‚û§</button>
                </div>
            </div>
        </div>
        <div class="card">
            <div class="card-title">Prediction Result</div>
            {% if prediction %}
            <div class="result">
                <div class="result-label">Predicted Annual Salary</div>
                <div class="result-salary">{{ prediction }}</div>
                <div class="result-meta">{{ job_title }} ¬∑ {{ location }} ¬∑ {{ experience }}</div>
                <div class="result-range">
                    <div class="range-item min"><div class="range-label">Min</div><div class="range-val">{{ min_salary }}</div></div>
                    <div class="range-item mid"><div class="range-label">Predicted</div><div class="range-val">{{ prediction }}</div></div>
                    <div class="range-item max"><div class="range-label">Max</div><div class="range-val">{{ max_salary }}</div></div>
                </div>
            </div>
            {% else %}
            <div class="empty-state"><div class="icon">üí∞</div><p>Fill in the form or chat to<br>get your salary prediction</p></div>
            {% endif %}
        </div>
    </div>
    <div class="charts-grid">
        <div class="chart-card"><div class="card-title">Top Paying Jobs</div><div style="font-size:11px;color:rgba(240,240,248,0.4);margin-bottom:8px;">All values in USD ¬∑ {{ chart_data.jobs.label }}</div><canvas id="jobChart" height="200"></canvas></div>
        <div class="chart-card"><div class="card-title">Salary by Experience</div><div style="font-size:11px;color:rgba(240,240,248,0.4);margin-bottom:8px;">All values in USD ¬∑ All job titles</div><canvas id="expChart" height="200"></canvas></div>
    </div>
</div>
<script>
function showTab(tab, el) {
    document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
    document.querySelectorAll(".panel").forEach(p => p.classList.remove("active"));
    document.getElementById(tab + "-panel").classList.add("active");
    el.classList.add("active");
}
async function sendMessage() {
    const input = document.getElementById("chat-input");
    const message = input.value.trim();
    if (!message) return;
    addMessage(message, "user");
    input.value = "";
    addMessage("Thinking...", "bot", "thinking");
    try {
        const response = await fetch("/chat", { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify({ message }) });
        const data = await response.json();
        const thinking = document.getElementById("thinking");
        if (thinking) thinking.remove();
        addMessage(data.response, "bot");
    } catch(e) {
        const thinking = document.getElementById("thinking");
        if (thinking) thinking.remove();
        addMessage("Sorry, something went wrong. Please try again.", "bot");
    }
}
function addMessage(text, sender, id) {
    const box = document.getElementById("chat-box");
    const div = document.createElement("div");
    div.className = "message " + sender;
    if (id) div.id = id;
    div.innerHTML = "<div class='bubble'>" + text + "</div>";
    box.appendChild(div);
    box.scrollTop = box.scrollHeight;
}
document.getElementById("chat-input").addEventListener("keypress", function(e) { if (e.key === "Enter") sendMessage(); });
const chartOpts = { plugins: { legend: { display: false } }, scales: { x: { ticks: { color: "rgba(240,240,248,0.45)", font: { size: 11 } }, grid: { color: "rgba(255,255,255,0.05)" } }, y: { ticks: { color: "rgba(240,240,248,0.45)", font: { size: 11 }, callback: v => "$" + (v/1000).toFixed(0) + "k" }, grid: { color: "rgba(255,255,255,0.05)" } } } };
const jobLabels = {{ chart_data.jobs.labels | tojson }};
const jobValues = {{ chart_data.jobs.data | tojson }};
const jobColors = jobLabels.map((_, i) => {
    const colors = ["#7c6aff","#8f7fff","#a290ff","#b5a3ff","#c8b6ff","#dbc9ff","#eeddff","#f5f0ff","#6affda","#ff6a9e","#ffaa6a","#a0f0a0"];
    return colors[i % colors.length];
});
new Chart(document.getElementById("jobChart"), { type: "bar", data: { labels: jobLabels, datasets: [{ data: jobValues, backgroundColor: jobColors, borderRadius: 6 }] }, options: { ...chartOpts, indexAxis: "y", plugins: { legend: { display: false }, title: { display: true, text: {{ chart_data.jobs.label | tojson }}, color: "rgba(240,240,248,0.6)", font: { size: 11 } } }, scales: { y: { ticks: { color: "rgba(240,240,248,0.6)", font: { size: 10 } }, grid: { display: false } }, x: { ticks: { color: "rgba(240,240,248,0.45)", font: { size: 10 }, callback: v => "$" + (v/1000).toFixed(0) + "k" }, grid: { color: "rgba(255,255,255,0.05)" } } } } });
new Chart(document.getElementById("expChart"), { type: "bar", data: { labels: ["Entry-level","Mid-level","Senior","Executive"], datasets: [{ data: [72000,105000,138000,185000], backgroundColor: ["#6affda","#7c6aff","#ff6a9e","#ffaa6a"], borderRadius: 8 }] }, options: chartOpts });
</script>
</body>
</html>
